metadata:
  suite_name: conditional_validation_example
  index_column: MATERIAL_NUMBER
  description: Example of conditional validations - format checks only run on materials with complete data
  data_source: abb_shop_data

validations:
  # Step 1: Check for required data presence
  - type: expect_column_values_to_not_be_null
    expectation_id: critical_fields_present
    columns:
      - ABP_ELECTRICALDATA1
      - ABP_EFFICIENCYLEVEL
      - ABP_FRAMESIZE

  # Step 2: Conditional format validation
  # Only check format if material has all required data (NOT in missing_critical_data group)
  - type: expect_column_values_to_match_regex
    expectation_id: electricaldata_format
    columns:
      - ABP_ELECTRICALDATA1
    regex: "^[A-Z0-9-]+$"
    conditional_on:
      derived_group: missing_critical_data
      membership: exclude  # Only run on materials NOT in the derived group

  # Another conditional validation
  - type: expect_column_values_to_match_regex
    expectation_id: framesize_format
    columns:
      - ABP_FRAMESIZE
    regex: "^[0-9]{2,4}[A-Z]?$"
    conditional_on:
      derived_group: missing_critical_data
      membership: exclude

derived_statuses:
  # Derived group: Materials missing critical data
  - expectation_id: missing_critical_data
    status: "Missing Critical Data"
    expectation_type: expect_column_values_to_not_be_null
    columns:
      - ABP_ELECTRICALDATA1
      - ABP_EFFICIENCYLEVEL
      - ABP_FRAMESIZE

  # Derived group: Materials with formatting issues (only evaluated on complete materials)
  - expectation_id: formatting_issues
    status: "Formatting Issues"
    expectation_type: expect_column_values_to_match_regex
    columns:
      - ABP_ELECTRICALDATA1
      - ABP_FRAMESIZE
